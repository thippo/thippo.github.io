<!DOCTYPE html>
<html>

        <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width, initial-scale=1">
                <link rel="stylesheet" href="../static/bootstrap4/css/bootstrap.min.css">
                <script src="../static/jquery-3.2.1.min.js"></script>
                <script src="../static/bootstrap4/popper.js"></script>
                <script src="../static/bootstrap4/js/bootstrap.min.js"></script>
                <script src="../static/vue.min.js"></script>
                <script src="../static/echarts.min.js"></script>
        </head>
        
        <body>

                <div class="container" id="appvue" style="background-color:#F5F5F5;">

                        <nav class="navbar navbar-expand-lg navbar-dark bg-dark rounded">
                                <a class="navbar-brand" href="#">THIPPO</a>
                                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                        <ul class="navbar-nav mr-auto">
                                                <li class="nav-item">
                                                        <a class="nav-link" href="../weight/index.html">体重记录 </a>
                                                </li>
                                                <li class="nav-item">
                                                        <a class="nav-link" href="../wealth/anabalancesheet.html">投资分析 </a>
                                                </li>
                                                <li class="nav-item ">
                                                        <a class="nav-link" href="../wealth/balancesheet.html">资产负债表 </a>
                                                </li>
                                                <li class="nav-item">
                                                        <a class="nav-link" href="../wealth/transaction/index.html">投资记录 </a>
                                                </li>
                                                <li class="nav-item active">
                                                        <a class="nav-link" href="tradetiming.html">择时分析 </a>
                                                </li>
                                                <li class="nav-item">
                                                        <a class="nav-link" href="convertiblebond.html">可转债YTM </a>
                                                </li>
                                                <li class="nav-item">
                                                        <a class="nav-link" href="newshare.html">七天实践 </a>
                                                </li>
                                        </ul>
                                </div>
                        </nav>
                        
                        <div class="progress" style="margin-top:10px;">
                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;" id="lifebar"></div>
                        </div>
                                        
                        </br>
                        <div class="row">
                        <div id="main" style="width:100%;height:500px;"></div>
                        </div>
                        
                        </br>
                        </br>

                </div>
                
                
                <script>
                        var raw_data = [
                                ['2021-7-21', 5144.04, 645340.11, 35687.5],
                                ['2021-7-22', 5151.75, 647601.06, 37846.43],
                                ['2021-7-23', 5089.23, 647320.89, 37532.03],
                                ['2021-7-26', 4925.3, 635028.16, 25243.42],
                                ['2021-7-27', 4751.31, 615950.58, 1731.97],
                                ['2021-7-28', 4760.48, 632032.93, 8974.11],
                                ['2021-7-29', 4850.27, 654065.37, 31043.95],
                                ['2021-7-30', 4811.17, 658848.36, 35809.36],
                                ['2021-8-2', 4933.74, 676373.1, 53340.35],
                                ['2021-8-3', 4934.46, 669264.61, 46215.74],
                                ['2021-8-4', 4978.85, 693559.97, 78844.97],
                                ['2021-8-5', 4948.67, 686322.01, 71638.41],
                                ['2021-8-6', 4921.56, 682995.21, 68326.14],
                                ['2021-8-9', 4985.56, 674707.95, 58322.2],
                                ['2021-8-10', 5043.15, 673622.35, 57234.58],
                                ['2021-8-11', 5015.34, 675881.88, 59487.72],
                                ['2021-8-12', 4973.35, 675805.27, 59407.4],
                                ['2021-8-13', 4945.98, 672665.29, 56260.58],
                                ['2021-8-16', 4941.07, 664292.95, 47897.57],
                                ['2021-8-17', 4837.4, 657933.9, 41601.45],
                                ['2021-8-18', 4894.24, 664379.94, 46978.39],
                                ['2021-8-19', 4862.14, 673493.52, 57082.13],
                                ['2021-8-20', 4769.27, 663244.39, 46832.16],
                                ['2021-8-23', 4835.88, 675860.86, 59429.26],
                                ['2021-8-24', 4888.39, 681028.77, 64592.14],
                                ['2021-8-25', 4898.16, 683251.14, 66808.38],
                                ['2021-8-26', 4801.61, 685530.18, 57465.69],
                                ['2021-8-27', 4827.04, 686535.72, 58453.97],
                                ['2021-8-30', 4813.27, 685441.04, 57323.91],
                                ['2021-8-31', 4805.61, 678744.96, 50617.0],
                                ['2021-9-1', 4869.46, 671047.91, 42917.02],
                                ['2021-9-2', 4869.41, 674533.81, 46396.77],
                                ['2021-9-3', 4843.06, 669135.3, 39961.59],
                                ['2021-9-6', 4933.73, 690261.85, 61060.02],
                                ['2021-9-7', 4992.83, 693159.93, 63954.57],
                                ['2021-9-8', 4972.13, 687623.18, 58421.69],
                                ['2021-9-9', 4970.01, 682174.38, 57438.99],
                                ['2021-9-10', 5013.52, 677826.46, 53088.22],
                                ['2021-9-13', 4991.66, 675384.59, 50846.68],
                                ['2021-9-14', 4917.16, 680953.71, 56405.38],
                                ['2021-9-15', 4867.32, 673601.08, 49058.52],
                                ['2021-9-16', 4807.70, 655851.89, 31319.55],
                                ['2021-9-17', 4855.94, 657654.53, 33114.52],
                                ['2021-9-22', 4821.77, 652825.96, 28288.04],
                                ['2021-9-23', 4853.20, 658307.05, 33758.24],
                                ['2021-9-24', 4849.43, 659621.63, 35059.21],
                                ['2021-9-27', 4877.37, 660285.57, 35717.07],
                                ['2021-9-28', 4883.83, 650303.13, 19102.65],
                                ['2021-9-29', 4833.93, 640045.47, 8850.35],
                                ['2021-9-30', 4866.38, 663650.33, 25334.09],
                                ['2021-10-8', 4929.94, 668505.3, 30171.26],
                                ['2021-10-11', 4936.19, 687901.65, 29564.3],
                                ['2021-10-12', 4883.84, 679832.75, 21499.15],
                                ['2021-10-13', 4940.16, 691082.41, 32731.25],
                                ['2021-10-14', 4913.61, 700175.24, 36816.36],
                                ['2021-10-15', 4931.82, 713262.47, 49982.68],
                                ['2021-10-18', 4874.78, 713156.61, 49867.12],
                                ['2021-10-19', 4922.72, 713821.81, 50520.51],
                                ['2021-10-20', 4910.18, 718291.97, 54977.5],
                                ['2021-10-21', 4928.02, 715567.23, 52248.05],
                                ['2021-10-22', 4959.73, 720582.7, 57232.58],
                                ['2021-10-25', 4979.52, 732372.37, 69001.91],
                                ['2021-10-26', 4963.1, 733270.08, 69896.49],
                                ['2021-10-27', 4898.16, 734687.91, 71304.9],
                                ['2021-10-28', 4864.14, 727285.33, 63915.83],
                                ['2021-10-29', 4908.77, 736633.1, 62014.14],
                                ['2021-11-1', 4890.69, 735113.27, 60521.07],
                                ['2021-11-2', 4839.85, 742217.04, 65370.37],
                                ['2021-11-3', 4821.11, 737499.79, 60648.78],
                                ['2021-11-4', 4868.74, 748953.16, 72078.75],
                                ['2021-11-5', 4842.35, 742267.72, 65368.17],
                                ['2021-11-8', 4848.18, 752243.68, 68143.6],
                                ['2021-11-9', 4846.74, 755405.79, 71291.5],
                                ['2021-11-10', 4821.19, 749940.16, 65841.88],
                                ['2021-11-11', 4898.65, 755034.7, 70920.28],
                                ['2021-11-12', 4888.37, 752605.5, 68457.38],
                                ['2021-11-15', 4882.38, 749348.57, 65194.1],
                                ['2021-11-16', 4883.32, 744712.8, 60551.95],
                                ['2021-11-17', 4885.75, 749565.03, 65388.25],
                                ['2021-11-18', 4837.62, 747272.41, 63090.57],
                                ['2021-11-19', 4890.06, 751151.13, 66924.84],
                                ['2021-11-22', 4912.4, 762772.97, 78520.67],
                                ['2021-11-23', 4913.35, 762396.03, 78131.29],
                                ['2021-11-24', 4916.66, 759066.28, 74791.8],
                                ['2021-11-25', 4896.44, 757874.1, 73588.56],
                                ['2021-11-26', 4860.13, 756114.54, 71789.61],
                                ['2021-11-29', 4851.42, 763490.4, 79159.73],
                                ['2021-11-30', 4832.03, 764683.69, 78286.55],
                                ['2021-12-1', 4843.85, 762596.85, 76171.72],
                                ['2021-12-2', 4856.16, 766147.28, 79703.57],
                                ['2021-12-3', 4901.02, 765234.6, 78750.19],
                                ['2021-12-6', 4892.62, 756715.22, 70251.5],
                                ['2021-12-7', 4922.1, 748177.57, 61710.9],
                                ['2021-12-8', 4995.93, 753855.48, 67370.12],
                                ['2021-12-9', 5078.69, 757212.7, 70709.27],
                                ['2021-12-10', 5055.12, 759509.41, 72958.56],
                                ['2021-12-13', 5083.8, 759240.43, 72701.35],
                                ['2021-12-14', 5049.7, 756609.81, 70050.65],
                                ['2021-12-15', 5005.9, 755258.51, 68688.37],
                                ['2021-12-16', 5034.73, 755642.11, 69058.68],
                                ['2021-12-17', 4954.76, 752156.02, 65530.93],
                                ['2021-12-20', 4880.42, 742649.35, 56021.72],
                                ['2021-12-21', 4913.49, 744402.31, 57757.61],
                                ['2021-12-22', 4914.45, 747166.21, 60503.89],
                                ['2021-12-23', 4948.74, 749695.32, 63021.0],
                                ['2021-12-24', 4921.34, 741045.54, 54343.57],
                                ['2021-12-27', 4919.32, 741777.9, 55058.15],
                                ['2021-12-28', 4955.96, 743638.02, 56896.51],
                                ['2021-12-29', 4883.48, 739528.99, 52773.55],
                                ['2021-12-30', 4921.51, 740284.41, 53502.85],
                                ['2021-12-31', 4940.37, 740782.48, 53867.54],
                                ['2022-1-4', 4917.77, 743431.46, 56485.8],
                                ['2022-1-5', 4868.12, 731443.52, 44493.87],
                                ['2022-1-6', 4818.23, 736288.44, 49319.3],
                                ['2022-1-7', 4822.37, 737263.02, 50258.82],
                                ['2022-1-10', 4844.05, 739962.89, 52946.1],
                                ['2022-1-11', 4797.77, 741213.74, 54214.54],
                                ['2022-1-12', 4845.58, 749410.24, 62419.55],
                                ['2022-1-13', 4765.92, 743513.38, 56515.3],
                                ['2022-1-14', 4726.73, 746468.06, 59415.82],
                                ['2022-1-17', 4767.28, 751642.73, 64568.79],
                                ['2022-1-18', 4813.35, 745780.79, 58698.08],
                                ['2022-1-19', 4780.38, 742239.66, 55146.75],
                                ['2022-1-20', 4823.51, 741769.72, 54662.42],
                                ['2022-1-21', 4779.31, 737933.37, 50935.53],
                                ]
                        
                        function cum_cal(data){
                                var sum = 1
                                for (i = 0; i < data.length; i++) {
                                        sum *= (1 + parseFloat(data[i])/100)
                                }
                                return ((sum - 1)*100).toFixed(4)
                        }

                        function splitdata(rawdata){
                                var date = []
                                var hs300 = []
                                var all = []
                                var hs300_cum = []
                                var all_cum = []
                                for (i = 1; i < rawdata.length; i++) { 
                                        date.push(rawdata[i][0])
                                        hs300.push((((rawdata[i][1]-rawdata[i-1][1])/rawdata[i-1][1])*100))
                                        all.push((((rawdata[i][3]-rawdata[i-1][3])/rawdata[i-1][2])*100))
                                }
                                for (j = 0; j < date.length; j++) { 
                                        hs300_cum.push(cum_cal(hs300.slice(0,j+1)))
                                        all_cum.push(cum_cal(all.slice(0,j+1)))
                                }
                                return {date:date,hs300:hs300_cum,all:all_cum}
                        }
                                  
                        
                        var new_data = splitdata(raw_data)
                        
                        var cha_list = []  
                        for (i=0;i<new_data.hs300.length;i++)
                        {
                            cha_list.push(new_data.all[i]-new_data.hs300[i])
                        }
                        
                        option = {
                                tooltip: {
                                        trigger: 'axis'
                                },
                                legend: {
                                        data: ['沪深300', '总盈利']
                                },
                                grid: {
                                        left: '3%',
                                        right: '4%',
                                        bottom: '3%',
                                        containLabel: true
                                },
                                xAxis: {
                                        type: 'category',
                                        boundaryGap: false,
                                        data: new_data.date
                                },
                                yAxis: {
                                        type: 'value'
                                },
                                series: [
                                        {
                                                name: '沪深300',
                                                type: 'line',
                                                smooth: true,
                                                symbol: 'none',
                                                color: 'red',
                                                data: new_data.hs300
                                        },
                                        {
                                                name: '总盈利',
                                                type: 'line',
                                                smooth: true,
                                                symbol: 'none',
                                                color: '#33CCFF',
                                                data: new_data.all
                                        },
                                        {
                                                name: '收益差',
                                                type: 'bar',
                                                color: 'rgba(0, 0, 0, 0.1)',
                                                label: {
                                                    show: false
                                                },
                                                data: cha_list
                                        },
                                ],
                                dataZoom: [
                                        {
                                                type: 'inside',
                                                start: 50,
                                                end: 100
                                        },
                                        {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                start: 50,
                                                end: 100
                                        }
                                ],
                        };

                        var myChart = echarts.init(document.getElementById('main'));
                        myChart.setOption(option,true);


        </script>

                <script>
                        var year=new Date().getFullYear();
                        var month=new Date().getMonth()+1;
                        var date=new Date().getDate();
                        s1  =  "1991-2-1";
                        s2  =  year+'-'+month+'-'+date;
                        day = DateDiff(s1, s2)/36525;
                        if (day<0.2){
                                $("#lifebar").attr({class:"progress-bar bg-success",style:"width:"+100*day+"%;"});
                        } else if (0.2<=day && day<0.4){
                                $("#lifebar").attr({class:"progress-bar bg-info",style:"width:"+100*day+"%;"});
                        } else if (0.4<=day && day<0.60){
                                $("#lifebar").attr({class:"progress-bar",style:"width:"+100*day+"%;"});
                        } else {
                                $("#lifebar").attr({class:"progress-bar bg-warning",style:"width:"+100*day+"%;"});
                        };
                        function DateDiff(sDate1, sDate2){  
                                var aDate, oDate1, oDate2, iDays;
                                aDate = sDate1.split("-");
                                oDate1 = new Date(aDate[1] + '-' + aDate[2] + '-' + aDate[0]);
                                aDate = sDate2.split("-");
                                oDate2 = new Date(aDate[1] + '-' + aDate[2] + '-' + aDate[0]);
                                iDays = parseInt(Math.abs(oDate1 - oDate2) / 1000 / 60 / 60 /24);
                                return iDays;
                        };
                </script>

        </body>
        
</html>
